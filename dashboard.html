<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š Trading Dashboard - Fran & Paco</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; font-size: 2em; }
        .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
        .phase-badge {
            display: inline-block;
            background: #f39c12;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 8px 8px 0 0;
            color: #888;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s;
        }
        .tab:hover { background: rgba(255,255,255,0.1); }
        .tab.active { background: rgba(52, 152, 219, 0.3); color: #3498db; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card h2 { font-size: 0.9em; color: #888; margin-bottom: 10px; text-transform: uppercase; }
        .card h3 { font-size: 1.1em; margin-bottom: 15px; color: #3498db; }
        .big-number { font-size: 2.5em; font-weight: bold; }
        .positive { color: #00d4aa; }
        .negative { color: #ff6b6b; }
        .neutral { color: #888; }
        .bullish { color: #00d4aa; }
        .bearish { color: #ff6b6b; }
        .stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .stat-label { color: #888; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px 8px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { color: #888; font-weight: normal; font-size: 0.85em; text-transform: uppercase; }
        .empty-state { text-align: center; padding: 40px; color: #666; }
        .update-time { text-align: center; color: #666; font-size: 0.85em; margin-top: 20px; }
        
        /* Modular Analysis Styles */
        .modular-card {
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .modular-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .asset-info h3 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        .asset-price {
            color: #888;
            font-size: 1.1em;
        }
        .final-score {
            text-align: center;
        }
        .score-value {
            font-size: 2.5em;
            font-weight: bold;
        }
        .score-positive { color: #00d4aa; }
        .score-negative { color: #ff6b6b; }
        .score-neutral { color: #f1c40f; }
        .decision-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1em;
            margin-top: 10px;
        }
        .decision-buy { background: rgba(0, 212, 170, 0.2); color: #00d4aa; }
        .decision-hold { background: rgba(241, 196, 15, 0.2); color: #f1c40f; }
        .decision-sell { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .module-box {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .module-name {
            font-size: 0.85em;
            color: #888;
        }
        .module-score {
            font-size: 1.3em;
            font-weight: bold;
        }
        .module-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .module-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }
        .module-weight {
            font-size: 0.75em;
            color: #666;
        }
        .module-reasoning {
            font-size: 0.8em;
            color: #999;
            margin-top: 8px;
            line-height: 1.4;
        }
        
        .recommendation-box {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 15px;
        }
        .recommendation-box h4 {
            color: #3498db;
            margin-bottom: 10px;
        }
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .level-box {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }
        .level-label {
            font-size: 0.75em;
            color: #888;
            margin-bottom: 5px;
        }
        .level-value {
            font-size: 1.1em;
            font-weight: bold;
        }
        .level-entry { color: #3498db; }
        .level-target { color: #00d4aa; }
        .level-stop { color: #ff6b6b; }
        
        .small-text { font-size: 0.85em; color: #888; }
        .signal-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }
        .signal-bullish { background: rgba(0, 212, 170, 0.2); color: #00d4aa; }
        .signal-bearish { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        .signal-neutral { background: rgba(136, 136, 136, 0.2); color: #888; }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
        }
        .summary-card.buy { border-color: rgba(0, 212, 170, 0.3); }
        .summary-card.hold { border-color: rgba(241, 196, 15, 0.3); }
        .summary-card.sell { border-color: rgba(255, 107, 107, 0.3); }
        .summary-asset {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .summary-score {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Trading Dashboard</h1>
        <p class="subtitle">Fran & Paco ðŸ¦… | <span class="phase-badge">ðŸŽ® PAPER TRADING</span></p>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('modular')">ðŸ§  AnÃ¡lisis Modular</button>
            <button class="tab" onclick="showTab('portfolio')">ðŸ’¼ Portfolio</button>
            <button class="tab" onclick="showTab('crypto')">ðŸª™ Cripto</button>
            <button class="tab" onclick="showTab('stocks')">ðŸ“ˆ Acciones</button>
        </div>
        
        <!-- MODULAR ANALYSIS TAB -->
        <div id="modular" class="tab-content active">
            <h2 style="margin-bottom: 20px;">ðŸ§  Sistema Modular de VotaciÃ³n</h2>
            
            <div class="summary-cards" id="summaryCards">
                <!-- Filled by JS -->
            </div>
            
            <div id="modularAnalysis">
                <!-- Filled by JS -->
            </div>
        </div>
        
        <!-- PORTFOLIO TAB -->
        <div id="portfolio" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>ðŸ’° Capital Total</h2>
                    <div class="big-number" id="totalCapital">100.00â‚¬</div>
                    <div class="stat-row">
                        <span class="stat-label">Disponible</span>
                        <span id="available">100.00â‚¬</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Invertido</span>
                        <span id="invested">0.00â‚¬</span>
                    </div>
                </div>
                
                <div class="card">
                    <h2>ðŸ“ˆ Rendimiento</h2>
                    <div class="big-number neutral" id="totalPL">+0.00â‚¬</div>
                    <div class="stat-row">
                        <span class="stat-label">Rendimiento %</span>
                        <span id="totalPLPercent">0.00%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Comisiones pagadas</span>
                        <span id="totalCommissions">0.00â‚¬</span>
                    </div>
                </div>
                
                <div class="card">
                    <h2>ðŸ“Š EstadÃ­sticas</h2>
                    <div class="stat-row">
                        <span class="stat-label">Total operaciones</span>
                        <span id="totalTrades">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Ganadoras</span>
                        <span class="positive" id="winningTrades">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Perdedoras</span>
                        <span class="negative" id="losingTrades">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Win Rate</span>
                        <span id="winRate">0%</span>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-bottom: 30px;">
                <h2>ðŸ“‚ Posiciones Abiertas</h2>
                <table>
                    <thead>
                        <tr><th>Activo</th><th>Cantidad</th><th>Entrada</th><th>Actual</th><th>P/L</th><th>%</th></tr>
                    </thead>
                    <tbody id="positionsBody">
                        <tr><td colspan="6" class="empty-state">No hay posiciones abiertas</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <h2>ðŸ“œ Historial de Operaciones</h2>
                <table>
                    <thead>
                        <tr><th>Fecha</th><th>Activo</th><th>Tipo</th><th>Cantidad</th><th>Precio</th><th>ComisiÃ³n</th><th>Resultado</th></tr>
                    </thead>
                    <tbody id="historyBody">
                        <tr><td colspan="7" class="empty-state">Sin operaciones todavÃ­a</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- CRYPTO TAB -->
        <div id="crypto" class="tab-content">
            <div class="card">
                <h2>ðŸª™ Precios Cripto (Bit2Me)</h2>
                <table>
                    <thead><tr><th>Activo</th><th>Precio</th><th>24h</th></tr></thead>
                    <tbody id="cryptoBody"></tbody>
                </table>
            </div>
        </div>
        
        <!-- STOCKS TAB -->
        <div id="stocks" class="tab-content">
            <div class="card">
                <h2>ðŸ“ˆ Precios Acciones (DEGIRO)</h2>
                <table>
                    <thead><tr><th>Activo</th><th>Precio</th><th>Cambio</th></tr></thead>
                    <tbody id="stocksBody"></tbody>
                </table>
            </div>
        </div>
        
        <p class="update-time">Dashboard actualizado por Paco ðŸ¦… | Di "Paco actualiza" para refrescar datos</p>
    </div>
    
    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        function getScoreClass(score) {
            if (score > 2) return 'score-positive';
            if (score < -2) return 'score-negative';
            return 'score-neutral';
        }
        
        function getDecisionClass(decision) {
            const d = decision.toLowerCase();
            if (d.includes('buy') || d.includes('comprar')) return 'decision-buy';
            if (d.includes('sell') || d.includes('vender')) return 'decision-sell';
            return 'decision-hold';
        }
        
        function getBarColor(score) {
            if (score > 0) return '#00d4aa';
            if (score < 0) return '#ff6b6b';
            return '#888';
        }
        
        function getBarWidth(score) {
            return Math.abs(score) * 10 + '%';
        }
        
        function renderModularAnalysis(asset, data) {
            const modules = data.modules;
            const moduleNames = {
                news: 'ðŸ“° Noticias',
                technical: 'ðŸ“Š TÃ©cnico',
                momentum: 'ðŸš€ Momentum',
                catalyst: 'ðŸŽ¯ Catalizador',
                risk: 'âš ï¸ Riesgo'
            };
            const weights = { news: 25, technical: 30, momentum: 20, catalyst: 15, risk: 10 };
            
            let modulesHtml = '';
            for (const [key, mod] of Object.entries(modules)) {
                const barColor = getBarColor(mod.score);
                
                // Check if technical module has short/long term
                let extraContent = '';
                if (key === 'technical' && mod.shortTerm && mod.longTerm) {
                    const stColor = getBarColor(mod.shortTerm.score);
                    const ltColor = getBarColor(mod.longTerm.score);
                    extraContent = `
                        <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                                <div style="flex: 1; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;">
                                    <div style="font-size: 0.7em; color: #888;">ðŸ“‰ CORTO PLAZO (${mod.shortTerm.timeframe})</div>
                                    <div style="font-size: 1.1em; font-weight: bold; color: ${stColor};">${mod.shortTerm.score > 0 ? '+' : ''}${mod.shortTerm.score}</div>
                                    <div style="font-size: 0.7em; color: #999; margin-top: 4px;">RSI: ${mod.shortTerm.indicators.rsi} | Z: ${mod.shortTerm.indicators.zscore}</div>
                                </div>
                                <div style="flex: 1; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;">
                                    <div style="font-size: 0.7em; color: #888;">ðŸ“ˆ LARGO PLAZO (${mod.longTerm.timeframe})</div>
                                    <div style="font-size: 1.1em; font-weight: bold; color: ${ltColor};">${mod.longTerm.score > 0 ? '+' : ''}${mod.longTerm.score}</div>
                                    <div style="font-size: 0.7em; color: #999; margin-top: 4px;">RSI: ${mod.longTerm.indicators.rsi} | Trend: ${mod.longTerm.indicators.trend_200d || 'N/A'}</div>
                                </div>
                            </div>
                            ${mod.divergence ? `<div style="font-size: 0.75em; color: #f1c40f; background: rgba(241,196,15,0.1); padding: 6px; border-radius: 4px;">âš¡ ${mod.divergence}</div>` : ''}
                        </div>
                    `;
                }
                
                modulesHtml += `
                    <div class="module-box">
                        <div class="module-header">
                            <span class="module-name">${moduleNames[key] || key}</span>
                            <span class="module-score" style="color: ${barColor}">${mod.score > 0 ? '+' : ''}${mod.score}</span>
                        </div>
                        <div class="module-bar">
                            <div class="module-bar-fill" style="width: ${Math.abs(mod.score) * 10}%; background: ${barColor};"></div>
                        </div>
                        <div class="module-weight">Peso: ${weights[key]}%</div>
                        <div class="module-reasoning">${mod.reasoning}</div>
                        ${extraContent}
                    </div>
                `;
            }
            
            const priceDisplay = data.priceEUR ? `$${data.price} (${data.priceEUR}â‚¬)` : `${data.price}â‚¬`;
            const changeDisplay = data.change24h ? data.change24h : data.change;
            const changeClass = changeDisplay > 0 ? 'positive' : changeDisplay < 0 ? 'negative' : '';
            
            return `
                <div class="modular-card">
                    <div class="modular-header">
                        <div class="asset-info">
                            <h3>${asset} - ${data.name}</h3>
                            <span class="asset-price">${priceDisplay} <span class="${changeClass}">(${changeDisplay > 0 ? '+' : ''}${changeDisplay.toFixed(2)}%)</span></span>
                        </div>
                        <div class="final-score">
                            <div class="score-value ${getScoreClass(data.finalScore)}">${data.finalScore > 0 ? '+' : ''}${data.finalScore.toFixed(2)}</div>
                            <div class="decision-badge ${getDecisionClass(data.decision)}">${data.decision}</div>
                        </div>
                    </div>
                    
                    <div class="modules-grid">
                        ${modulesHtml}
                    </div>
                    
                    <div class="recommendation-box">
                        <h4>ðŸ’¡ RecomendaciÃ³n: ${data.recommendation.action}</h4>
                        <p>${data.reasoning}</p>
                        <div class="levels-grid">
                            <div class="level-box">
                                <div class="level-label">Entrada</div>
                                <div class="level-value level-entry">${data.recommendation.entry_level}${data.priceEUR ? '$' : 'â‚¬'}</div>
                            </div>
                            <div class="level-box">
                                <div class="level-label">Target</div>
                                <div class="level-value level-target">${data.recommendation.target}${data.priceEUR ? '$' : 'â‚¬'}</div>
                            </div>
                            <div class="level-box">
                                <div class="level-label">Stop Loss</div>
                                <div class="level-value level-stop">${data.recommendation.stop_loss}${data.priceEUR ? '$' : 'â‚¬'}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function loadData() {
            try {
                // Load portfolio
                const portfolioRes = await fetch('data/portfolio.json', { cache: 'no-cache' });
                const portfolio = await portfolioRes.json();
                
                document.getElementById('totalCapital').textContent = portfolio.balance.totalWithGains.toFixed(2) + 'â‚¬';
                document.getElementById('available').textContent = portfolio.balance.available.toFixed(2) + 'â‚¬';
                document.getElementById('invested').textContent = portfolio.balance.invested.toFixed(2) + 'â‚¬';
                
                const pl = portfolio.stats.totalProfitLoss;
                const plPercent = ((portfolio.balance.totalWithGains - portfolio.meta.initialCapital) / portfolio.meta.initialCapital * 100);
                const plEl = document.getElementById('totalPL');
                plEl.textContent = (pl >= 0 ? '+' : '') + pl.toFixed(2) + 'â‚¬';
                plEl.className = 'big-number ' + (pl > 0 ? 'positive' : pl < 0 ? 'negative' : 'neutral');
                document.getElementById('totalPLPercent').textContent = (plPercent >= 0 ? '+' : '') + plPercent.toFixed(2) + '%';
                document.getElementById('totalCommissions').textContent = portfolio.stats.totalCommissions.toFixed(2) + 'â‚¬';
                
                document.getElementById('totalTrades').textContent = portfolio.stats.totalTrades;
                document.getElementById('winningTrades').textContent = portfolio.stats.winningTrades;
                document.getElementById('losingTrades').textContent = portfolio.stats.losingTrades;
                document.getElementById('winRate').textContent = portfolio.stats.totalTrades > 0 
                    ? (portfolio.stats.winningTrades / portfolio.stats.totalTrades * 100).toFixed(0) + '%' : '0%';
                
                // Load prices first for positions
                const pricesRes = await fetch('data/prices.json', { cache: 'no-cache' });
                const prices = await pricesRes.json();
                
                // Render positions with live prices
                const positionsBody = document.getElementById('positionsBody');
                if (portfolio.positions && portfolio.positions.length > 0) {
                    let posHtml = '';
                    let totalInvestedValue = 0;
                    for (const pos of portfolio.positions) {
                        // Get current price from prices.json
                        let currentPrice = pos.currentPrice;
                        if (prices.crypto[pos.symbol]) {
                            currentPrice = prices.crypto[pos.symbol].eur;
                        } else if (prices.stocks[pos.symbol]) {
                            currentPrice = prices.stocks[pos.symbol].eur;
                        }
                        const currentValue = currentPrice * pos.quantity;
                        totalInvestedValue += currentValue;
                        const pl = currentValue - pos.entryValue;
                        const plPct = ((currentPrice - pos.entryPrice) / pos.entryPrice * 100);
                        const plClass = pl > 0 ? 'positive' : pl < 0 ? 'negative' : '';
                        posHtml += `<tr>
                            <td><strong>${pos.symbol}</strong><br><span class="small-text">${pos.name}</span></td>
                            <td>${pos.quantity.toFixed(6)}</td>
                            <td>${pos.entryPrice.toLocaleString('es-ES')}â‚¬</td>
                            <td>${currentPrice.toLocaleString('es-ES')}â‚¬</td>
                            <td class="${plClass}">${pl >= 0 ? '+' : ''}${pl.toFixed(2)}â‚¬</td>
                            <td class="${plClass}">${plPct >= 0 ? '+' : ''}${plPct.toFixed(2)}%</td>
                        </tr>`;
                    }
                    positionsBody.innerHTML = posHtml;
                    
                    // Update total with gains
                    const totalWithGains = portfolio.balance.available + totalInvestedValue;
                    document.getElementById('totalCapital').textContent = totalWithGains.toFixed(2) + 'â‚¬';
                    const totalPL = totalWithGains - portfolio.meta.initialCapital;
                    const plEl = document.getElementById('totalPL');
                    plEl.textContent = (totalPL >= 0 ? '+' : '') + totalPL.toFixed(2) + 'â‚¬';
                    plEl.className = 'big-number ' + (totalPL > 0 ? 'positive' : totalPL < 0 ? 'negative' : 'neutral');
                    const plPctTotal = (totalPL / portfolio.meta.initialCapital * 100);
                    document.getElementById('totalPLPercent').textContent = (plPctTotal >= 0 ? '+' : '') + plPctTotal.toFixed(2) + '%';
                } else {
                    positionsBody.innerHTML = '<tr><td colspan="6" class="empty-state">No hay posiciones abiertas</td></tr>';
                }
                
                // Render history
                const historyBody = document.getElementById('historyBody');
                if (portfolio.history && portfolio.history.length > 0) {
                    let histHtml = '';
                    for (const trade of portfolio.history.slice().reverse()) {
                        const resultClass = trade.result > 0 ? 'positive' : trade.result < 0 ? 'negative' : '';
                        const dateStr = new Date(trade.date).toLocaleDateString('es-ES', {day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'});
                        histHtml += `<tr>
                            <td>${dateStr}</td>
                            <td><strong>${trade.symbol}</strong></td>
                            <td>${trade.type}</td>
                            <td>${trade.value.toFixed(2)}â‚¬</td>
                            <td>${trade.price.toLocaleString('es-ES')}â‚¬</td>
                            <td>${trade.commission.toFixed(2)}â‚¬</td>
                            <td class="${resultClass}">${trade.result >= 0 ? '+' : ''}${trade.result.toFixed(2)}â‚¬</td>
                        </tr>`;
                    }
                    historyBody.innerHTML = histHtml;
                } else {
                    historyBody.innerHTML = '<tr><td colspan="7" class="empty-state">Sin operaciones todavÃ­a</td></tr>';
                }
                
                // Crypto prices
                let cryptoHtml = '';
                for (const [symbol, data] of Object.entries(prices.crypto)) {
                    const changeClass = data.change24h > 0 ? 'positive' : data.change24h < 0 ? 'negative' : '';
                    cryptoHtml += `<tr>
                        <td><strong>${symbol}</strong></td>
                        <td>${data.eur.toLocaleString('es-ES')}â‚¬</td>
                        <td class="${changeClass}">${data.change24h > 0 ? '+' : ''}${data.change24h.toFixed(2)}%</td>
                    </tr>`;
                }
                document.getElementById('cryptoBody').innerHTML = cryptoHtml;
                
                // Stock prices
                let stocksHtml = '';
                for (const [symbol, data] of Object.entries(prices.stocks)) {
                    const changeClass = data.change > 0 ? 'positive' : data.change < 0 ? 'negative' : '';
                    stocksHtml += `<tr>
                        <td><strong>${symbol}</strong></td>
                        <td>$${data.usd.toFixed(2)} (${data.eur.toFixed(2)}â‚¬)</td>
                        <td class="${changeClass}">${data.change > 0 ? '+' : ''}${data.change.toFixed(2)}%</td>
                    </tr>`;
                }
                document.getElementById('stocksBody').innerHTML = stocksHtml;
                
                // Load modular analyses
                const assets = ['BTC', 'ETH', 'SOL', 'NVDA', 'LINK', 'AAVE'];
                let modularHtml = '';
                let summaryHtml = '';
                
                for (const asset of assets) {
                    try {
                        const res = await fetch(`analysis/modular/${asset}.json`, { cache: 'no-cache' });
                        const data = await res.json();
                        modularHtml += renderModularAnalysis(asset, data);
                        
                        const scoreClass = getScoreClass(data.finalScore);
                        const decisionClass = data.decision.toLowerCase().includes('hold') ? 'hold' : 
                                             data.decision.toLowerCase().includes('buy') ? 'buy' : 'sell';
                        summaryHtml += `
                            <div class="summary-card ${decisionClass}">
                                <div class="summary-asset">${asset}</div>
                                <div class="small-text">${data.name}</div>
                                <div class="summary-score ${scoreClass}">${data.finalScore > 0 ? '+' : ''}${data.finalScore.toFixed(2)}</div>
                                <div class="decision-badge ${getDecisionClass(data.decision)}">${data.decision}</div>
                            </div>
                        `;
                    } catch (e) {
                        console.log(`No modular analysis for ${asset}`);
                    }
                }
                
                document.getElementById('modularAnalysis').innerHTML = modularHtml || '<p class="empty-state">No hay anÃ¡lisis modulares</p>';
                document.getElementById('summaryCards').innerHTML = summaryHtml;
                
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }
        
        loadData();
        setInterval(loadData, 60000);
    </script>
</body>
</html>
